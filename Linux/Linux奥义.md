# 第一节：Linux奥义

### 命令

1.统计一列中不同数据及重复次数：

```shell
awk '{sum[$2]++}END{for(i in sum) print i "\t" sum[i]}' test.txt
1.1.1.1        结果=>    1.1.1.1 2
2.2.2.2	                2.2.2.2	1
3.3.3.3					3.3.3.3	1
4.4.4.4					4.4.4.4	1
1.1.1.1.
```



### 写时复制

写入时复制是一种计算机程序设计领域的优化策略；其核心思想是，如果有多个调用者同时请求相同资源（如内存或磁盘上的数据存储），他们会共同获取相同的指针指向相同的资源，直到某个调用者试图修改资源的内容时，系统才会真正复制一份专用副本（private copy）给该调用者，而其他调用者所见到的最初的资源仍然保持不变。这个过程对其他的调用者是透明的（transparently）。此作法的主要优点是如果调用者没有修改该资源，就不会有副本（private copy）被建立，因此多个调用者只是读取操作是可以共享同一份资源。

#### 应用：

##### 虚拟内存管理中的写时复制

一般把这种被共享访问的页面标记为只读。当一个task试图向内存中写入数据时，[内存管理单元](https://zh.wikipedia.org/wiki/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%8D%95%E5%85%83)（MMU）抛出一个异常，内核处理该异常时为该task分配一份物理内存并复制数据到此内存，重新向MMU发出执行该task的写操作。

##### 数据存储中的写时复制

[Linux]等的文件管理系统使用了写时复制策略。

[数据库]服务器也一般采用了写时复制策略，为用户提供一份snapshot。