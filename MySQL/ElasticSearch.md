# 第五节：ElasticSearch

### 基础

ES不是数据库，它适合于海量数据、更新频率很低的数据(ES没有事务也不适合处理并行更改数据)，创建文档后，es不支持更新域（字段类型）。
ES是全文搜索引擎，能够对中文进行全文搜索，处理同义词和根据相关性给文档打分；能根据同一份数据生成分析和聚合的结果；在没有大量工作进程（线程）的情况下能做到对数据的实时处理。


### 坑
#### 分页
ES默认的分页机制一个不足的地方是，比如有5010条数据，当你仅想取第5000到5010条数据的时候，ES也会将前5000条数据加载到内存当中，ES为了避免用户的过大分页请求造成ES服务所在机器内存溢出，默认对深度分页的条数进行了限制，默认的最大条数是10000条。
解决方案1：
修改配置，调整的新的窗口数：
```
curl -XPUT http://127.0.0.1:9200/my_index/_settings -d '{ "index" : { "max_result_window" : 500000}}'。
```
缺点：窗口值调大了后，虽然请求到分页的数据条数更多了，但它是用牺牲更多的服务器的内存、CPU资源来换取的。
解决方案2：
https://www.elastic.co/guide/en/elasticsearch/reference/5.6/search-request-search-after.html，利用search_after参数
scroll查询原理是在第一次查询的时候一次性生成一个快照，根据上一次的查询的id来进行下一次的查询，这个就类似于关系型数据库的游标，然后每次滑动都是根据产生的游标id进行下一次查询，这种性能比上面说的分页性能要高出很多，基本都是毫秒级的。
缺点：不支持跨页查询
解决方案3：
每次查询超过10000万条记录的时候，都会去更新一次index。
缺点：慢

### 版本更新

ES从5.X就引入了text和keyword，其中keyword用于不分词字段，搜索时只能完全匹配；到了6.X就彻底移除string了，“index”的值就只能是boolean变量了。
